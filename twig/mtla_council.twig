{% extends "page.twig" %}

{% block title %}{{ 'mtla_council_page.header'|trans }}{% endblock %}

{% block breadcrumbs %}
    <li><a href="/" aria-current="page">{{ 'common.short_name'|trans }}</a></li>
    <li><a href="/mtla/" aria-current="page">{{ 'nav.mtla'|trans }}</a></li>
    <li class="is-active"><a href="#" aria-current="page">{{ 'nav.council'|trans }}</a></li>
{% endblock %}


{% block content %}
    <script>
        $(function () {
            $(".table").tablesorter();
        });
    </script>
    <style>
        .delegation_tree li > ul {
            margin-left: 2em;
        }
    </style>

    <h1 class="title">{{ 'mtla_council_page.header'|trans }}</h1>

    {% if delegation_tree %}
        {% macro renderDelegationTree(tree, level) %}
            <ul>
                {% for node in tree %}
                    <li>
                        {% if node.is_ready_to_council %}üôã{% endif %}
                        {% if node.candidate_index %}<span class="tag {{ node.candidate_index <= 20 ? 'is-primary' : 'is-info' }}">{{ node.candidate_index }}</span>{% endif %}
                        {% if node.is_council %}üèõÔ∏è{% endif %}
                        {{ include('account_link.twig', {data: node}, with_context = false) }}
                        <span class="has-text-dark">
                        {{ node.own_token_amount }} + {{ node.delegated_token_amount }} =
                        {{ node.own_token_amount + node.delegated_token_amount }}
                        </span>
                        {% if node.delegated is not empty %}
                            {{ _self.renderDelegationTree(node.delegated, level + 1) }}
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endmacro %}

        <div class="block delegation_tree">
        {{ _self.renderDelegationTree(delegation_tree, 0) }}
        </div>
    {% endif %}

{% endblock %}

