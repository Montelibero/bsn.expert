{% extends "page.twig" %}

{% block title %}{{ 'transactions.show.header'|trans({'%hash%': tx_hash}) }}{% endblock %}

{% block breadcrumbs %}
    <li><a href="/" aria-current="page">{{ 'common.short_name'|trans }}</a></li>
    <li><a href="/transactions/" aria-current="page">{{ 'transactions.title'|trans }}</a></li>
    <li class="is-active"><a href="#" aria-current="page">{{ tx_hash }}</a></li>
{% endblock %}

{% block content %}
    <h1 class="title">{{ 'transactions.show.header'|trans }} {{ include('account_link.twig', {data: transaction.source_account_data}, with_context = false) }}</h1>
    <p class="subtitle">
        <span class="stellar_address is-family-monospace">{{ tx_hash }}</span><br>
        {{ 'transactions.show.alternatives'|trans }}:
        <a class="tag is-link" href="https://viewer.eurmtl.me/transaction/{{ tx_hash }}">Eurmtl.me</a>
        <a class="tag is-dark" href="https://lore.mtlprog.xyz/transactions/{{ tx_hash }}">Lore</a>
        <a class="tag is-primary" href="https://stellar.expert/explorer/public/tx/{{ tx_hash }}">Stellar.Expert</a>
        <a class="tag is-info" href="https://scopuly.com/transaction/{{ tx_hash }}">Scopuly</a>
    </p>

    {% if not transaction.successful %}
        <section class="block hero is-danger">
            <div class="hero-body">
                <p class="title">{{ 'transactions.show.status'|trans }}: {{ 'transactions.show.failed'|trans }}</p>
                <p class="subtitle">{{ 'transactions.show.failed_description'|trans }}</p>
            </div>
        </section>
    {% endif %}

    <p class="block">
        {{ 'transactions.show.created_at'|trans }}: {{ transaction.created_at|date('Y-m-d H:i:s') }} UTC<br>

        {{ 'transactions.show.ledger'|trans }} {{ transaction.ledger }},
        {{ 'transactions.show.operation_count'|trans }}: {{ transaction.operation_count }}<br>

        {% if transaction.fee_account and transaction.fee_account_data.id != transaction.source_account_data.id %}
            {{ 'transactions.show.fee_account'|trans }}: {{ include('account_link.twig', {data: transaction.fee_account_data}, with_context = false) }}<br>
        {% endif %}

        {{ 'transactions.show.fee_charged'|trans }}:
            {% include 'amount.twig' with {value: transaction.fee_charged_xlm} only %} XLM
            {% if transaction.max_fee_xlm -%}
                ({{ 'transactions.show.fee_max'|trans }} {% include 'amount.twig' with {value: transaction.max_fee_xlm} only %})
            {%- endif -%}
        <br>

        {{ 'transactions.show.memo'|trans }}:
        {% if transaction.memo.value %}
            <code>{{ transaction.memo.value }}</code>
        {% else %}
            {{ 'transactions.show.memo_absent'|trans }}
        {% endif %}
    </p>

    {% if transaction.operations %}
        <h2 class="title is-4">{{ 'transactions.show.operations'|trans }}</h2>
        <div class="block content">
            <ol>
                {% for op in transaction.operations %}
                    {% set type_key = 'transactions.operations.types.' ~ op.type %}
                    {% set type_label = type_key|trans %}
                    {% if op.type == 'manage_data' and op.data.cleared is defined and op.data.cleared %}
                        {% set type_label = 'transactions.operations.manage_data.delete_title'|trans %}
                    {% elseif op.data.action_label is defined and op.data.action_label %}
                        {% set type_label = op.data.action_label %}
                    {% elseif type_label == type_key %}
                    {% set type_label = 'transactions.operations.types.default'|trans ~ ' (' ~ op.type ~ ')' %}
                    {% endif %}
                    <li class="mb-5">
                        <div>
                            {% include 'operations/icon.twig' with {op: op, context_account_id: transaction.source_account} %}
                            <strong>{{ type_label }}</strong>
                        </div>
                        <div>{{ 'transactions.operations.source'|trans }}:
                            {{ include('account_link.twig', {data: op.source_account_data}, with_context = false) }}
                        </div>
                        {% include op.template ignore missing with {op: op} only %}
                        {% if op.unsupported %}
                            <div class="has-text-grey">{{ 'transactions.operations.unsupported'|trans }}</div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ol>
        </div>
    {% endif %}
{% endblock %}
